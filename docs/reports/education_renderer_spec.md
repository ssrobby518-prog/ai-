# Z5ï¼šEducation Renderer è¦æ ¼æ–‡ä»¶ï¼ˆæˆäººæ•™è‚²ç‰ˆ v2ï¼‰

## ç›®çš„

Z5 æ˜¯ pipeline çš„æœ€å¾Œä¸€å±¤è½‰è­¯å™¨ï¼Œè² è²¬å°‡ Z4 ç”¢å‡ºçš„ã€Œåˆ†æžå¸«ç‰ˆã€æ·±åº¦åˆ†æžå ±å‘Šï¼Œè½‰è­¯ç‚ºä¸éœ€è¦æŠ€è¡“èƒŒæ™¯å³å¯ç†è§£çš„æˆäººæ•™è‚²ç‰ˆå ±å‘Šã€‚

ç›®æ¨™è®€è€…ï¼š0 åŸºç¤Žä½†æœ‰å¤§å­¸æ•™è‚²èƒŒæ™¯çš„æˆäººï¼ˆç”¢å“ç¶“ç†ã€æŠ•è³‡äººã€ç®¡ç†å±¤ï¼‰ã€‚
é¢¨æ ¼å®šä½ï¼šæ·ºç™½ä½†ä¸å¹¼ç¨šâ€”â€”ç”¨ç²¾æº–çš„ç™½è©±æ–‡å–ä»£è¡“èªžï¼Œè€ŒéžæŠŠå…§å®¹é™ç´šã€‚

æ•™è‚²ç‰ˆå ±å‘Šçš„ç‰¹è‰²ï¼š
- Notion / PPT / XMind ä¸‰ç¨®æ ¼å¼åŒæ­¥è¼¸å‡º
- 6 é¡Œ QA ç³»çµ±èªªæ˜Žï¼ˆå« Pipeline/ETL æ¦‚å¿µï¼‰
- Mermaid ç³»çµ±æµç¨‹åœ–
- äº‹å¯¦æ ¸å°ï¼ˆFact Checkï¼‰+ è­‰æ“šç‰‡æ®µ
- æŠ€è¡“/å•†æ¥­è§£è®€ï¼ˆ120-220 å­—ï¼‰
- äºŒéšŽæ•ˆæ‡‰è¡¨æ ¼
- å¯åŸ·è¡Œè¡Œå‹•ï¼ˆå«å‹•ä½œ+ç”¢å‡ºç‰©+æœŸé™ï¼‰
- Metrics å¥åº·åº¦å„€è¡¨æ¿ + æŽ’éŒ¯æŒ‡å¼•
- Sprint å»ºè­°
- ç¹é«”ä¸­æ–‡èªªæ˜Žï¼ˆåŽŸæ–‡å¼•ç”¨ä¿ç•™åŽŸèªžè¨€ä¸¦é™„ç¹ä¸­è§£é‡‹ï¼‰
- éžæ–°èžå…§å®¹è‡ªå‹•åµæ¸¬èˆ‡æ¨™è¨˜

## è¼¸å…¥

Z5 æ”¯æ´å…©ç¨®è¼¸å…¥æ¨¡å¼ï¼Œç¨‹å¼è‡ªå‹•é¸æ“‡ï¼š

### æ¨¡å¼ Aï¼ˆå„ªå…ˆï¼‰ï¼šçµæ§‹åŒ–è¼¸å…¥

| åƒæ•¸ | é¡žåž‹ | èªªæ˜Ž |
|------|------|------|
| `results` | `list[MergedResult]` | Z2 çš„åˆä½µçµæžœåˆ—è¡¨ |
| `report` | `DeepAnalysisReport` | Z4 çš„æ·±åº¦åˆ†æžå ±å‘Š |
| `metrics` | `dict` | pipeline metricsï¼ˆä¾†è‡ª MetricsCollector.to_dict()ï¼‰ |

### æ¨¡å¼ Bï¼ˆfallbackï¼‰ï¼šæ–‡æœ¬è¼¸å…¥

| åƒæ•¸ | é¡žåž‹ | èªªæ˜Ž |
|------|------|------|
| `deep_analysis_text` | `str` | `outputs/deep_analysis.md` çš„å…¨æ–‡ |
| `metrics` | `dict` | `outputs/metrics.json` çš„å…§å®¹ |

fallback è§£æžä½¿ç”¨æ®µè½åˆ†å‰² + é—œéµå­—è¾¨è­˜ï¼ˆéž fragile regexï¼‰ï¼Œæœ€ä½Žé™åº¦æ‹†å‡º item_idã€æ ¸å¿ƒäº‹å¯¦ã€è­‰æ“šç‰‡æ®µã€‚

## è¼¸å‡º

æ¯æ¬¡åŸ·è¡Œç”Ÿæˆ 4 ä»½æª”æ¡ˆï¼š

| æª”æ¡ˆ | è·¯å¾‘ | èªªæ˜Ž |
|------|------|------|
| Notion ç‰ˆ | `docs/reports/deep_analysis_education_version.md` | ä¸»æª”ï¼ŒNotion å‹å–„ |
| PPT ç‰ˆ | `docs/reports/deep_analysis_education_version_ppt.md` | ä¸€é ä¸€æ®µåˆ‡ç‰‡ç‰ˆ |
| XMind å¤§ç¶± | `docs/reports/deep_analysis_education_version_xmind.md` | 2-ç©ºæ ¼ç¸®æŽ’éšŽå±¤å¤§ç¶± |
| outputs å‰¯æœ¬ | `outputs/deep_analysis_education.md` | pipeline è¼¸å‡ºåŒæ­¥å‰¯æœ¬ |

## ç« ç¯€è¦æ ¼ï¼ˆNotion ç‰ˆï¼‰

é †åºå›ºå®šï¼Œä¸å¯çœç•¥ï¼š

### 1. å°é¢è³‡è¨Š

è¡¨æ ¼æ ¼å¼ + é–±è®€æŒ‡å—ï¼ŒåŒ…å«ï¼š
- å ±å‘Šæ™‚é–“ï¼ˆæœ¬æ©Ÿæ™‚å€ï¼‰
- Run ID
- åˆ†æžé …ç›®æ•¸ï¼ˆæœ‰æ•ˆ/ç„¡æ•ˆæ‹†åˆ†ï¼‰
- å…¨æ–‡æŠ“å–æˆåŠŸçŽ‡
- ç¸½åŸ·è¡Œæ™‚é–“
- ä¸»è¦å¤±æ•—åŽŸå› ï¼ˆäººè©±ç¿»è­¯ç‰ˆï¼‰
- é–±è®€æŒ‡å—ï¼ˆ3 æ­¥ï¼šä»Šæ—¥çµè«– â†’ æ–°èžå¡ç‰‡ â†’ Metricsï¼‰

### 2. ä»Šæ—¥çµè«–ï¼ˆExecutive Summaryï¼‰

åŒ…å«ï¼š
- æœ‰æ•ˆ/ç„¡æ•ˆé …ç›®çµ±è¨ˆ
- æ¶µè“‹ä¸»é¡Œæ‘˜è¦
- å¯ä¿¡åº¦è©•ä¼°ï¼ˆåŸºæ–¼ success_rateï¼‰
- æŒ‡æ¨™è¡¨æ ¼ï¼ˆæœ‰æ•ˆé …ç›®ã€ç„¡æ•ˆé …ç›®ã€ä¸»è¦ä¾†æºã€ä¸»è¦ä¸»é¡Œï¼‰

### 3.ã€Œé€™å¥—ç³»çµ±åˆ°åº•åœ¨åšä»€éº¼ã€QA

å›ºå®š 6 é¡Œï¼š
- Q1ï¼šé€™ä»½å ±å‘Šçš„è¼¸å…¥æ˜¯ä»€éº¼ï¼Ÿ
- Q2ï¼šè¼¸å‡ºæ˜¯ä»€éº¼ï¼Ÿ
- Q3ï¼šä»€éº¼æ˜¯ Pipelineï¼ˆè³‡æ–™è™•ç†ç®¡ç·šï¼‰ï¼Ÿï¼ˆå« ETL èªªæ˜Žï¼‰
- Q4ï¼šç‚ºä»€éº¼è¦æ‰“åˆ†æ•¸ï¼Ÿåˆ†æ•¸ä»£è¡¨ä»€éº¼ï¼Ÿï¼ˆå« Quality Gate èªªæ˜Žï¼‰
- Q5ï¼šç‚ºä»€éº¼æœƒå‡ºç¾ã€Œä¸æ˜¯æ–°èžçš„å­—ä¸²ã€ï¼Ÿ
- Q6ï¼šæˆ‘ä»Šå¤©è¦åšçš„æœ€å°å‹•ä½œæ˜¯ä»€éº¼ï¼Ÿï¼ˆ3 æ­¥è¡Œå‹•ï¼‰

### 4. ç³»çµ±æµç¨‹åœ–

Mermaid flowchart LR æ ¼å¼ï¼Œå‘ˆç¾ Z1â†’Z2â†’Z3â†’Z4â†’Z5 çš„å®Œæ•´æµç¨‹ï¼Œé™„å„ç«™ç™½è©±èªªæ˜Žã€‚

### 5. ä»Šæ—¥æ–°èžå¡ç‰‡

æ¯å‰‡æ–°èžä¸€å¼µå¡ï¼Œæœ‰æ•ˆæ–°èžå¿…å«ï¼š

| å€å¡Š | èªªæ˜Ž |
|------|------|
| æ‘˜è¦ | ç™¼ç”Ÿäº†ä»€éº¼ + ç‚ºä»€éº¼é‡è¦ + é—œæ³¨é‡é»ž |
| äº‹å¯¦æ ¸å°ï¼ˆFact Checkï¼‰ | âœ… å·²ç¢ºèªäº‹å¯¦ + âš ï¸ å¾…é©—è­‰é …ç›® |
| è­‰æ“šç‰‡æ®µï¼ˆEvidence Snippetsï¼‰ | åŽŸæ–‡å¼•ç”¨ + ç¹ä¸­èªªæ˜Ž |
| æŠ€è¡“/å•†æ¥­è§£è®€ | 120-220 å­—æ·±åº¦åˆ†æž + é¡žæ¯”ç†è§£ |
| äºŒéšŽæ•ˆæ‡‰ï¼ˆSecond-order Effectsï¼‰ | è¡¨æ ¼ï¼šé¡žåž‹/å½±éŸ¿/è§€å¯ŸæŒ‡æ¨™ |
| å¯åŸ·è¡Œè¡Œå‹•ï¼ˆActionsï¼‰ | å«æœŸé™ï¼ˆæœ¬é€±å…§/å…©é€±å…§ï¼‰+ ç”¢å‡ºç‰© |
| åª’é«”èˆ‡å»¶ä¼¸è³‡æº | ðŸ–¼ï¸ å»ºè­°é…åœ– + ðŸŽ¬ å½±ç‰‡æœå°‹ + ðŸ“Ž é–±è®€æŽ¨è–¦ + ðŸ”— åŽŸå§‹é€£çµ |

ç„¡æ•ˆå…§å®¹å¡ç‰‡æ ¼å¼ï¼š

| å€å¡Š | èªªæ˜Ž |
|------|------|
| åˆ¤å®š | âš ï¸ ç„¡æ•ˆå…§å®¹æ¨™è¨˜ |
| å¯èƒ½åŽŸå›  | ç‚ºä»€éº¼è¢«åˆ¤å®šç‚ºç„¡æ•ˆ |
| ä¿®å¾©å»ºè­° | å…·é«”çš„æ”¹å–„æ–¹æ¡ˆ |
| åŽŸæ–‡ç‰‡æ®µ | å‰ 100 å­— + ç¹ä¸­èªªæ˜Ž |

### 6. Metrics èˆ‡é‹ç¶­å»ºè­°

åŒ…å«ï¼š
- å¥åº·åº¦å„€è¡¨æ¿ï¼ˆè¡¨æ ¼ï¼šæŒ‡æ¨™/æ•¸å€¼/è§£è®€/å»ºè­°é–€æª»ï¼‰
- ç´…é»ƒç¶ ç‡ˆç¸½é«”è©•ä¼°
- ä¸‰å±¤æŽ’éŒ¯æŒ‡å¼•ï¼ˆå¿«é€Ÿ/ä¸­ç­‰/æ·±å…¥ï¼Œå« PowerShell + Bash æŒ‡ä»¤ï¼‰
- Sprint å»ºè­°ï¼ˆ5 æ¢æ”¹å–„æ–¹å‘ï¼‰

## PPT ç‰ˆè¦æ ¼

- æ¯é ä»¥ `---` åˆ†éš”
- æ¯é æœ€å¤š 10 è¡Œ
- åŒ…å«å°é¢ã€çµè«–ã€æµç¨‹åœ–ï¼ˆMermaidï¼‰ã€æ¯å‰‡æ–°èžï¼ˆæ‘˜è¦é +äº‹å¯¦é +è¡Œå‹•é ï¼‰ã€Metrics é 

## XMind å¤§ç¶±è¦æ ¼

- 2-ç©ºæ ¼ç¸®æŽ’çš„ç´”æ–‡å­—éšŽå±¤å¤§ç¶±
- æ ¹ç¯€é»žï¼š`AI æ·±åº¦æƒ…å ±åˆ†æžï¼ˆæ™‚é–“æˆ³ï¼‰`
- äºŒç´šç¯€é»žï¼šä»Šæ—¥çµè«–ã€ç³»çµ±æµç¨‹ï¼ˆZ1-Z5ï¼‰ã€æ–°èž Nã€ç„¡æ•ˆé …ç›® Nã€Metrics & é‹ç¶­
- æœ‰æ•ˆæ–°èžå­ç¯€é»žï¼šæ‘˜è¦ã€äº‹å¯¦æ ¸å°ã€è­‰æ“šã€æŠ€è¡“è§£è®€ã€äºŒéšŽæ•ˆæ‡‰ã€è¡Œå‹•å»ºè­°ã€ç´ æ

## ç´…é»ƒç¶ ç‡ˆè¦å‰‡

| ç‡ˆè™Ÿ | æ¢ä»¶ | æ„ç¾© |
|------|------|------|
| ðŸŸ¢ ç¶ ç‡ˆ | success_rate >= 80% **ä¸”** p95 < 30s | ç³»çµ±å¥åº·ï¼Œè³‡æ–™å“è³ªè‰¯å¥½ |
| ðŸŸ¡ é»ƒç‡ˆ | success_rate >= 50% **æˆ–** p95 < 60s | éƒ¨åˆ†ç•°å¸¸ï¼Œä½†æ•´é«”ä»å¯ä½¿ç”¨ |
| ðŸ”´ ç´…ç‡ˆ | å…¶é¤˜æƒ…æ³ | å¤šé …æŒ‡æ¨™ç•°å¸¸ï¼Œå»ºè­°æŽ’æŸ¥ |

## éžæ–°èžå…§å®¹åµæ¸¬

### is_system_banner

ç³»çµ±æœƒè‡ªå‹•åµæ¸¬ä»¥ä¸‹æ¨¡å¼ä¸¦æ¨™è¨˜ç‚ºã€Œâš ï¸ éžæ–°èžå…§å®¹ã€ï¼š

- `You signed in / out / switched accounts`
- `Reload to refresh your session`
- `Cookie` / `Accept all cookies`
- `Sign in to` / `Log in to`
- `Dismiss alert`
- GitHub diff ç›¸é—œï¼ˆ`Copy file name to clipboard`ã€`Display the source diff` ç­‰ï¼‰

åµæ¸¬è¦å‰‡ï¼šå‘½ä¸­ 2 å€‹ä»¥ä¸Šæ¨¡å¼ï¼Œæˆ–å…¨æ–‡ < 200 å­—ä¸”å‘½ä¸­ 1 å€‹ã€‚

### is_invalid_itemï¼ˆæ“´å±•ç‰ˆï¼‰

åœ¨ `is_system_banner` åŸºç¤Žä¸Šå¢žåŠ çŸ­æ–‡åµæ¸¬ï¼š
- å…§å®¹ < 80 å­—ä¸”ç¼ºå°‘å¯è¾¨è­˜çš„ä¸­è‹±æ–‡åè©žï¼ˆä¸­æ–‡è©ž 2+ å­—ã€è‹±æ–‡è©ž 4+ å­—æ¯ï¼Œåˆè¨ˆ < 2ï¼‰â†’ ç„¡æ•ˆ

## è¨­å®šé …ï¼ˆ.envï¼‰

| è®Šæ•¸ | é è¨­å€¼ | èªªæ˜Ž |
|------|--------|------|
| `EDU_REPORT_ENABLED` | `true` | æ˜¯å¦å•Ÿç”¨æ•™è‚²ç‰ˆå ±å‘Š |
| `EDU_REPORT_MAX_ITEMS` | `0`ï¼ˆä¸é™åˆ¶ï¼‰ | æœ€å¤šè™•ç†å¹¾å‰‡æ–°èž |
| `EDU_REPORT_LANGUAGE` | `zh-TW` | è¼¸å‡ºèªžè¨€ |
| `EDU_REPORT_INCLUDE_MEDIA_PLACEHOLDERS` | `true` | æ˜¯å¦åŒ…å«å»ºè­°é…åœ–/å½±ç‰‡å ä½ |
| `EDU_REPORT_LEVEL` | `adult` | æ·±åº¦ç­‰ç´šï¼š`adult`ï¼ˆæˆäººç‰ˆï¼‰æˆ– `teen`ï¼ˆé’å°‘å¹´ç‰ˆï¼Œä¿ç•™ä¸é è¨­ï¼‰ |

## å¸¸è¦‹éŒ¯èª¤èˆ‡å°æ‡‰

| éŒ¯èª¤ç¢¼ | äººè©±ç¿»è­¯ | å°ä½¿ç”¨è€…çš„å»ºè­° |
|--------|----------|---------------|
| `extract_low_quality` | å…¨æ–‡æŠ½å–å“è³ªä¸è¶³ï¼ˆç¶²é å…§å®¹éŽå°‘æˆ–æ ¼å¼ç‰¹æ®Šï¼Œç„¡æ³•æ“·å–å®Œæ•´æ–‡ç« ï¼‰ | æ›ä¸€å€‹ä¾†æºæˆ–èª¿æ•´æŠ“å–é‚è¼¯ |
| `blocked` | è¢«ç›®æ¨™ç¶²ç«™å°éŽ–ï¼ˆå°æ–¹çš„åçˆ¬èŸ²æ©Ÿåˆ¶é˜»æ­¢äº†æˆ‘å€‘çš„å­˜å–ï¼‰ | å¯èƒ½éœ€è¦è¨­å®šä»£ç†æˆ–æ›´æ› UA |
| `connection_error` | ç¶²è·¯é€£ç·šå¤±æ•—ï¼ˆDNS è§£æžéŒ¯èª¤ã€é€£ç·šé€¾æ™‚æˆ–ä¼ºæœå™¨ç„¡å›žæ‡‰ï¼‰ | æª¢æŸ¥ç¶²è·¯é€£ç·š |
| `timeout` | è«‹æ±‚é€¾æ™‚ï¼ˆç›®æ¨™ä¼ºæœå™¨å›žæ‡‰éŽæ…¢ï¼Œè¶…éŽè¨­å®šçš„ç­‰å¾…ä¸Šé™ï¼‰ | ç¨å¾Œå†è©¦æˆ–èª¿é«˜ timeout |
| `parse_error` | å…§å®¹è§£æžå¤±æ•—ï¼ˆç¶²é çµæ§‹ä¸ç¬¦åˆé æœŸï¼Œå¯èƒ½æ˜¯æ”¹ç‰ˆæˆ–å‹•æ…‹è¼‰å…¥ï¼‰ | ç¶²ç«™å¯èƒ½æ”¹ç‰ˆäº† |
| `rate_limited` | è«‹æ±‚é »çŽ‡éŽé«˜è¢«é™é€Ÿï¼ˆçŸ­æ™‚é–“å…§ç™¼å‡ºå¤ªå¤šè«‹æ±‚ï¼Œè¢«ä¼ºæœå™¨æš«æ™‚å°éŽ–ï¼‰ | é™ä½ŽæŠ“å–é »çŽ‡ |
| `404` | é é¢ä¸å­˜åœ¨ï¼ˆæ–‡ç« å¯èƒ½å·²åˆªé™¤æˆ– URL å·²å¤±æ•ˆï¼‰ | è©²æ–‡ç« å·²ä¸‹æž¶ |
| `encoding_error` | æ–‡å­—ç·¨ç¢¼éŒ¯èª¤ï¼ˆåŽŸå§‹ç¶²é çš„å­—å…ƒç·¨ç¢¼å®£å‘Šä¸æ­£ç¢ºï¼Œå°Žè‡´äº‚ç¢¼ï¼‰ | æª¢æŸ¥ä¾†æºç·¨ç¢¼ |

## æ“´å±•æ–¹å¼

1. **æ–°å¢žæ¯”å–»åˆ†é¡ž**ï¼šåœ¨ `education_renderer.py` çš„ `_METAPHOR_BANK` å­—å…¸æ–°å¢žåˆ†é¡ž
2. **æ–°å¢žè¡“èªžç¿»è­¯**ï¼šåœ¨ `education_models.py` çš„ `TERM_METAPHORS` å­—å…¸æ–°å¢žè¡“èªž
3. **æ–°å¢ž banner æ¨¡å¼**ï¼šåœ¨ `education_models.py` çš„ `SYSTEM_BANNER_PATTERNS` åˆ—è¡¨æ–°å¢ž
4. **æ–°å¢žå¤±æ•—åŽŸå› ç¿»è­¯**ï¼šåœ¨ `education_models.py` çš„ `FAIL_REASON_TRANSLATIONS` å­—å…¸æ–°å¢ž
5. **æ–°å¢ž XMind å­ç¯€é»ž**ï¼šåœ¨ `education_renderer.py` çš„ `_render_xmind_md()` å‡½å¼ä¸­æ“´å……

## èˆ‡ pipeline çš„æ•´åˆ

Z5 åœ¨ `scripts/run_once.py` çš„ Z4 å®Œæˆå¾ŒåŸ·è¡Œï¼š
- è‹¥ Z5 å¤±æ•—ï¼Œpipeline ä»æˆåŠŸï¼ˆexit code 0ï¼‰
- å¤±æ•—æ™‚åœ¨ log è¨˜éŒ„ ERRORï¼Œä¸¦åœ¨ outputs æ”¾ä¸€ä»½ã€Œæ•™è‚²ç‰ˆç”Ÿæˆå¤±æ•—èªªæ˜Žã€ï¼ˆå« tracebackï¼‰
- å— `EDU_REPORT_ENABLED` è¨­å®šæŽ§åˆ¶
- å›žå‚³ 3-tupleï¼š`(notion_md, ppt_md, xmind_md)`

## å›žæ»¾ / åœç”¨æ–¹å¼

1. åœ¨ `.env` è¨­å®š `EDU_REPORT_ENABLED=false` å³å¯åœç”¨
2. ä¸éœ€è¦åˆªé™¤ä»»ä½•ç¨‹å¼ç¢¼
3. æ—¢æœ‰çš„ Z4 å ±å‘Šï¼ˆ`outputs/deep_analysis.md`ï¼‰ä¸å—å½±éŸ¿
4. è‹¥è¦åˆ‡å›žé’å°‘å¹´ç‰ˆï¼ˆæœªä¾†å¦‚éœ€ï¼‰ï¼Œè¨­å®š `EDU_REPORT_LEVEL=teen`
